name: test and build
on: push

jobs: 
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - run: make test

  image-push:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - run: make image-push DOCKER_USERNAME=${{ secrets.DOCKER_USERNAME }} DOCKER_PASSWORD=${{ secrets.DOCKER_PASSWORD }}
    needs: test
